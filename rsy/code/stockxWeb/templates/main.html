<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Sales Data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <h2> 销售总览</h2>
    
    <!-- <a href="/download" id="downloadButton" class="btn btn-primary">Download Excel File</a> -->

    <div class="form-container">
        <form action="/search_SKU">
            <label for="sku">SKU:</label>
            <input type="text" id="sku" name="sku" placeholder="Enter SKU to search">
            <input type="submit" value="搜索" class="btn btn-primary">
        </form>
    </div>
    <div class="table-container">
        <!-- 此处使用 |safe 是因为默认情况下 Jinja2 会转义所有的变量，如果你希望该变量不被转义（因为其内容是安全可靠的HTML代码），需要使用 safe 过滤器 -->
        <table>
            {% macro latest_info(row, base) %}
                <td> {{ row[base + '_count'] }} </td>
                {% set count = row[base + '_count'] %}
                {% set low_price = "\\" if count == 0 else row[base + '_lowPrice'] %}
                {% set high_price = "\\" if count == 0 else row[base + '_highPrice'] %}
                <td> {{ low_price }} </td>
                <td> {{ high_price }} </td>
            {% endmacro %}
            {% macro latest_info_expr(row, base) %}
                <td> {{ row[base + '_count_expr'] }} </td>  
                {% set count_expr = row[base + '_count_expr'] %}
                {% set low_price_expr = "\\" if count_expr == 0 else row[base + '_lowPrice_expr'] %}
                {% set high_price_expr = "\\" if count_expr == 0 else row[base + '_highPrice_expr'] %}
                <td> {{ low_price_expr }} </td>
                <td> {{ high_price_expr }} </td>
            {% endmacro %}
        
            <tr>
                <th rowspan="2">Shoe Name</th>
                <th rowspan="2">SKU</th>
                <th colspan="3">3 Days Express Info</th>
                <th colspan="3">7 Days Express Info</th>
                <th colspan="3">30 Days Express Info</th>
                <th colspan="3">3 Days Info</th>
                <th colspan="3">7 Days Info</th>
                <th colspan="3">30 Days Info</th>
                <th rowspan="2">Total Sales Number</th>
            </tr>
            <tr>
                {% for _ in range(6) %}
                    <th>count</th>
                    <th>lowPrice</th>
                    <th>highPrice</th>
                {% endfor %}
            </tr>
        
            {% for row in data.itertuples() %}
            <tr>
            <tr>
                <!-- 这里我们创建一个链接，链接到'detail_page'路由，并附上shoename参数 -->
                <tr>
                <!-- 这里我们创建一个链接，链接到'detail_page'路由，并附上shoename参数 -->
                    <td><a href="{{ url_for('shoe_page', shoename=row.shoeName) }}">{{ row.shoeName }}</a></td>
                    <td>{{ row.sku }}</td>
                    {{ latest_info_expr(row, 'latest_3days') }}
                    {{ latest_info_expr(row, 'latest_7days') }}
                    {{ latest_info_expr(row, 'latest_30days') }}
                    {{ latest_info(row, 'latest_3days') }}
                    {{ latest_info(row, 'latest_7days') }}
                    {{ latest_info(row, 'latest_30days') }}
                    <td>{{ row.salesNum }}</td>
                </tr>
            {% endfor %}
        </table>
    </div>

    <div class="paging">
        {% if page == 1 %}
            <a href="/main?page={{ page - 1 }}" aria-disabled="true">Previous Page</a>
            <a href="/main?page={{ page + 1 }}">Next Page</a>
        {% elif page == total_page %}
            <a href="/main?page={{ page - 1 }}">Previous Page</a>
            <a href="/main?page={{ page + 1 }}" aria-disabled="true">Next Page</a>
        {% else %}
            <a href="/main?page={{ page - 1 }}">Previous Page</a>
            <a href="/main?page={{ page + 1 }}">Next Page</a>
        {% endif %}
    </div>
    <script src="{{ url_for('static', filename='js/main/disable_flip.js') }}"></script>
</body>
</html>
